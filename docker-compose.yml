version: '3.7'
services:
  notification-mongodb:
    container_name: "notification-mongodb"
    image: mongo:latest
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
    ports:
      - 27017:27017
    volumes:
      - mongodb_data_container:/data/db
    networks:
      - innotter-micro-service_internship-net
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
  
  notification-rabbitmq3:
    container_name: "notification-rabbitmq"
    image: rabbitmq:3.8-management-alpine
    environment:
       - RABBITMQ_DEFAULT_USER=admin
       - RABBITMQ_DEFAULT_PASS=password
    ports:
       - '5672:5672'
       - '15672:15672'
    networks:
      - innotter-micro-service_internship-net
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "ping"]
  
  notitficattion-listener:
    container_name: notitficattion-listener
    build: 
      context: .
      network: host
    volumes:
      - ./app:/code/app
    depends_on:
      notification-rabbitmq3:
        condition: service_healthy
      notification-mongodb:
        condition: service_healthy
    env_file:
      - .env
    networks:
      - innotter-micro-service_internship-net


volumes:
  mongodb_data_container:

networks:
  innotter-micro-service_internship-net:
    external: true
